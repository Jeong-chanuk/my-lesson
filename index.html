<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìˆ˜ì—… ì˜ˆì•½ ì‹œìŠ¤í…œ - ìµœì¢…</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; }
        .slot { 
            padding: 20px; margin: 10px; border-radius: 12px;
            border: 2px solid #eee; display: inline-block; min-width: 150px;
            text-align: center; cursor: pointer; transition: 0.3s;
        }
        .booked { background-color: #ffe5e5; border-color: #ffcccc; color: #ff4d4d; cursor: not-allowed; }
        .available { background-color: #e5f9ff; border-color: #cceeff; color: #0077aa; font-weight: bold; }
        .available:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .student-name { display: block; font-size: 0.8em; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ“… ìˆ˜ì—… ì˜ˆì•½ í˜„í™©</h1>
    <p>ì›í•˜ëŠ” ì‹œê°„ëŒ€ë¥¼ í´ë¦­í•˜ì—¬ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
    <div id="lesson-list">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <script>
        const SUPABASE_URL = 'https://stjmbuhxmdnogmzmeqmt.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_GJe263qFZFStFSXh2oT3AA_D2wUEqmD'; 

        async function fetchLessons() {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/MyClass?select=*`, {
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });
            const lessons = await response.json();
            displayLessons(lessons);
        }

        function displayLessons(lessons) {
            const listDiv = document.getElementById('lesson-list');
            listDiv.innerHTML = '';
            lessons.sort((a, b) => a.id - b.id);

            lessons.forEach(lesson => {
                const div = document.createElement('div');
                div.className = `slot ${lesson.is_booked ? 'booked' : 'available'}`;
                
                let content = `<strong>${lesson.time}</strong><br>`;
                content += lesson.is_booked ? 'ì˜ˆì•½ì™„ë£Œ' : 'ì˜ˆì•½ê°€ëŠ¥';
                
                // ì˜ˆì•½ëœ ê²½ìš° ì´ë¦„ í‘œì‹œ (ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ)
                if (lesson.is_booked && lesson.student_name) {
                    content += `<span class="student-name">(${lesson.student_name}ë‹˜)</span>`;
                }
                
                div.innerHTML = content;
                if (!lesson.is_booked) div.onclick = () => bookLesson(lesson.id, lesson.time);
                listDiv.appendChild(div);
            });
        }

        async function bookLesson(id, time) {
            const name = prompt(`${time} ì˜ˆì•½ì„ ìœ„í•´ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:`);
            if (!name || name.trim() === "") return;

            const response = await fetch(`${SUPABASE_URL}/rest/v1/MyClass?id=eq.${id}`, {
                method: 'PATCH',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ is_booked: true, student_name: name })
            });

            if (response.ok) {
                alert(`${name}ë‹˜, ${time} ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);
                fetchLessons();
            }
        }

        fetchLessons();
    </script>
</body>
</html>