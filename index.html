<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¦¬ë¯¸ì—„ ìˆ˜ì—… ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --primary-color: #4dabf7;
            --booked-color: #ff8787;
            --text-dark: #343a40;
        }

        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: var(--bg-color);
            color: var(--text-dark);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        h1 { margin-bottom: 10px; color: #212529; }
        .subtitle { color: #868e96; margin-bottom: 30px; }

        /* ë‹¬ë ¥ ê·¸ë¦¬ë“œ ì„¤ì • */
        #lesson-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 900px;
        }

        /* ê°œë³„ ì‹œê°„í‘œ ì¹´ë“œ ë””ìì¸ */
        .slot {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        /* ì˜ˆì•½ ê°€ëŠ¥ ìƒíƒœ */
        .available {
            border-color: #e7f5ff;
        }
        .available:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        .available strong { color: var(--primary-color); font-size: 1.2em; }

        /* ì˜ˆì•½ ì™„ë£Œ ìƒíƒœ */
        .booked {
            background-color: #fff5f5;
            border-color: #ffe3e3;
            cursor: not-allowed;
            opacity: 0.8;
        }
        .booked strong { color: var(--booked-color); }

        .status-badge {
            display: inline-block;
            margin-top: 10px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .available .status-badge { background: #e7f5ff; color: #1971c2; }
        .booked .status-badge { background: #ffe3e3; color: #c92a2a; }

        .student-name {
            display: block;
            margin-top: 8px;
            font-size: 13px;
            color: #495057;
            font-weight: bold;
        }

        /* ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) */
        .refresh-btn {
            margin-bottom: 20px;
            padding: 8px 15px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <h1>ğŸ“… ìˆ˜ì—… ì˜ˆì•½ ì‹œê°„í‘œ</h1>
    <p class="subtitle">ì›í•˜ëŠ” ì‹œê°„ì„ ì„ íƒí•˜ì—¬ ì˜ˆì•½ì„ í™•ì •í•˜ì„¸ìš”.</p>
    
    <button class="refresh-btn" onclick="fetchLessons()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>

    <div id="lesson-list">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <script>
        // ì„ ìƒë‹˜ì˜ ì‹¤ì œ ì •ë³´ë¡œ ìœ ì§€í•´ ì£¼ì„¸ìš”!
        const SUPABASE_URL = 'https://stjmbuhxmdnogmzmeqmt.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_GJe263qFZFStFSXh2oT3AA_D2wUEqmD'; 

        async function fetchLessons() {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/MyClass?select=*`, {
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });
            const lessons = await response.json();
            displayLessons(lessons);
        }

        function displayLessons(lessons) {
            const listDiv = document.getElementById('lesson-list');
            listDiv.innerHTML = '';
            
            // ID ìˆœì„œëŒ€ë¡œ ì •ë ¬ (ì‹œê°„ìˆœ)
            lessons.sort((a, b) => a.id - b.id);

            lessons.forEach(lesson => {
                const div = document.createElement('div');
                const isBooked = lesson.is_booked;
                div.className = `slot ${isBooked ? 'booked' : 'available'}`;
                
                div.innerHTML = `
                    <strong>${lesson.time}</strong><br>
                    <span class="status-badge">${isBooked ? 'ì˜ˆì•½ì™„ë£Œ' : 'ì˜ˆì•½ê°€ëŠ¥'}</span>
                    ${isBooked && lesson.student_name ? `<span class="student-name">ğŸ‘¤ ${lesson.student_name}ë‹˜</span>` : ''}
                `;
                
                if (!isBooked) {
                    div.onclick = () => bookLesson(lesson.id, lesson.time);
                }
                listDiv.appendChild(div);
            });
        }

        async function bookLesson(id, time) {
            const name = prompt(`${time} ì˜ˆì•½ì„ ìœ„í•´ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:`);
            if (!name || name.trim() === "") return;

            const response = await fetch(`${SUPABASE_URL}/rest/v1/MyClass?id=eq.${id}`, {
                method: 'PATCH',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ is_booked: true, student_name: name })
            });

            if (response.ok) {
                alert(`${name}ë‹˜, ${time} ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);
                fetchLessons();
            }
        }

        fetchLessons();
    </script>
</body>
</html>