<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìˆ˜ì—… ì˜ˆì•½ í…ŒìŠ¤íŠ¸ - ì§‘</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .slot { 
            padding: 15px; margin: 10px; border-radius: 8px;
            border: 1px solid #ddd; display: inline-block; 
            cursor: pointer; transition: 0.3s;
        }
        .booked { background-color: #ffcccc; cursor: not-allowed; color: #666; }
        .available { background-color: #ccffcc; font-weight: bold; }
        .available:hover { background-color: #b3ffb3; transform: scale(1.05); }
    </style>
</head>
<body>
    <h1>ğŸ“… í˜„ì¬ ì˜ˆì•½ í˜„í™© (Home)</h1>
    <p>ì›í•˜ëŠ” ì‹œê°„ëŒ€ë¥¼ í´ë¦­í•˜ì—¬ ì˜ˆì•½í•´ë³´ì„¸ìš”.</p>
    <div id="lesson-list">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <script>
        // 1. ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ë³¸ì¸ì˜ URLê³¼ KEYë¥¼ ë„£ì–´ì£¼ì„¸ìš”!
        const SUPABASE_URL = 'https://stjmbuhxmdnogmzmeqmt.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_GJe263qFZFStFSXh2oT3AA_D2wUEqmD'; 

        // 2. ë°±ì—”ë“œ(MyClass í…Œì´ë¸”)ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchLessons() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/MyClass?select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                const lessons = await response.json();
                displayLessons(lessons);
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
            }
        }

        // 3. í™”ë©´ì— ê·¸ë¦¬ê¸°
        function displayLessons(lessons) {
            const listDiv = document.getElementById('lesson-list');
            listDiv.innerHTML = '';
            lessons.sort((a, b) => a.id - b.id);

            lessons.forEach(lesson => {
                const div = document.createElement('div');
                div.className = `slot ${lesson.is_booked ? 'booked' : 'available'}`;
                div.innerText = `${lesson.time} - ${lesson.is_booked ? 'ì˜ˆì•½ì™„ë£Œ' : 'ì˜ˆì•½ê°€ëŠ¥'}`;
                
                if (!lesson.is_booked) {
                    div.onclick = () => bookLesson(lesson.id);
                }
                listDiv.appendChild(div);
            });
        }

        // 4. ì˜ˆì•½ ì—…ë°ì´íŠ¸
        async function bookLesson(id) {
            if (!confirm("ì´ ì‹œê°„ìœ¼ë¡œ ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const response = await fetch(`${SUPABASE_URL}/rest/v1/MyClass?id=eq.${id}`, {
                method: 'PATCH',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify({ is_booked: true })
            });

            if (response.ok) {
                alert("ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤!");
                fetchLessons();
            }
        }

        fetchLessons();
    </script>
</body>
</html>