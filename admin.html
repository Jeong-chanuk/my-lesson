<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ì—… ê´€ë¦¬ì ëª¨ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #339af0; --red: #ff6b6b; --gray: #f8f9fa; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--gray); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .admin-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); width: 100%; max-width: 500px; }
        h2 { margin-top: 0; color: var(--blue); }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--blue); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .schedule-list { margin-top: 30px; width: 100%; max-width: 500px; }
        .schedule-item { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .status-on { color: var(--blue); font-weight: bold; }
        .status-off { color: #aaa; text-decoration: line-through; }
        .del-btn { background: var(--red); color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; width: auto; margin: 0; }
    </style>
</head>
<body>

    <div class="admin-card">
        <h2>ğŸ“… ìˆ˜ì—… ì‹œê°„í‘œ ê°œì„¤</h2>
        <div class="input-group">
            <label>ë‚ ì§œ ì„ íƒ</label>
            <input type="date" id="lesson-date">
        </div>
        <div class="input-group">
            <label>ì‹œê°„ ì…ë ¥ (ì˜ˆ: 14:00)</label>
            <input type="text" id="lesson-time" placeholder="HH:MM">
        </div>
        <button onclick="createSchedule()">ìˆ˜ì—… ì˜¤í”ˆí•˜ê¸°</button>
    </div>

    <div class="schedule-list" id="schedule-list">
        <h3 id="list-title">ì—´ë ¤ ìˆëŠ” ìˆ˜ì—… ëª©ë¡</h3>
        </div>

    <script>
        const SUPABASE_URL = 'https://stjmbuhxmdnogmzmeqmt.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_GJe263qFZFStFSXh2oT3AA_D2wUEqmD'; 

        // 1. ìˆ˜ì—… ê°œì„¤ í•¨ìˆ˜
        async function createSchedule() {
            const date = document.getElementById('lesson-date').value;
            const time = document.getElementById('lesson-time').value;

            if(!date || !time) return alert("ë‚ ì§œì™€ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.");

            const res = await fetch(`${SUPABASE_URL}/rest/v1/ClassSchedules`, {
                method: 'POST',
                headers: { 
                    'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' 
                },
                body: JSON.stringify({
                    lesson_date: date,
                    lesson_time: time,
                    is_available: true
                })
            });

            if (res.ok) {
                alert("ìˆ˜ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ê°œì„¤ë˜ì—ˆìŠµë‹ˆë‹¤!");
                fetchSchedules();
            }
        }

        // 2. ê°œì„¤ëœ ìˆ˜ì—… ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        async function fetchSchedules() {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/ClassSchedules?order=lesson_date.asc,lesson_time.asc`, {
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });
            const data = await res.json();
            renderSchedules(data);
        }

        function renderSchedules(data) {
            const list = document.getElementById('schedule-list');
            list.innerHTML = '<h3>ì—´ë ¤ ìˆëŠ” ìˆ˜ì—… ëª©ë¡</h3>';

            data.forEach(s => {
                const div = document.createElement('div');
                div.className = 'schedule-item';
                div.innerHTML = `
                    <div>
                        <strong>${s.lesson_date}</strong> | ${s.lesson_time} 
                        <span class="${s.is_available ? 'status-on' : 'status-off'}">
                            (${s.is_available ? 'ì˜ˆì•½ê°€ëŠ¥' : 'ë§ˆê°'})
                        </span>
                    </div>
                    <button class="del-btn" onclick="deleteSchedule('${s.id}')">ì‚­ì œ</button>
                `;
                list.appendChild(div);
            });
        }

        // 3. ìˆ˜ì—… ì‚­ì œ í•¨ìˆ˜
        async function deleteSchedule(id) {
            if(!confirm("ì´ ìˆ˜ì—… ì‹œê°„ì„ ì•„ì˜ˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const res = await fetch(`${SUPABASE_URL}/rest/v1/ClassSchedules?id=eq.${id}`, {
                method: 'DELETE',
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });

            if (res.ok) {
                fetchSchedules();
            }
        }

        // ì´ˆê¸° ë¡œë“œ
        fetchSchedules();
    </script>
</body>
</html>